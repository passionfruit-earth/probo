apiVersion: v1
kind: Secret
metadata:
  name: {{ include "probo.fullname" . }}
  labels:
    {{- include "probo.labels" . | nindent 4 }}
type: Opaque
stringData:
  # Database credentials
  db-password: {{ if .Values.postgresql.enabled }}{{ .Values.postgresql.auth.postgresPassword | quote }}{{ else }}{{ required "postgresql.password is required when postgresql.enabled=false" .Values.postgresql.password | quote }}{{ end }}
  {{- if .Values.postgresql.caBundle }}
  pg-ca-bundle: {{ .Values.postgresql.caBundle | quote }}
  {{- end }}

  # S3 credentials
  s3-access-key: {{ include "probo.s3.accessKeyId" . | quote }}
  s3-secret-key: {{ include "probo.s3.secretAccessKey" . | quote }}

  # Application secrets
  encryption-key: {{ .Values.probo.encryptionKey | required "probo.encryptionKey is required" | quote }}
  cookie-secret: {{ .Values.probo.auth.cookieSecret | required "probo.auth.cookieSecret is required" | quote }}
  password-pepper: {{ .Values.probo.auth.passwordPepper | required "probo.auth.passwordPepper is required" | quote }}
  trust-token-secret: {{ .Values.probo.trustAuth.tokenSecret | required "probo.trustAuth.tokenSecret is required" | quote }}

  # Optional SMTP credentials
  {{- if .Values.probo.mailer.smtp.user }}
  smtp-user: {{ .Values.probo.mailer.smtp.user | quote }}
  {{- end }}
  {{- if .Values.probo.mailer.smtp.password }}
  smtp-password: {{ .Values.probo.mailer.smtp.password | quote }}
  {{- end }}

  # Optional OpenAI API key
  {{- if .Values.probo.openai.apiKey }}
  openai-api-key: {{ .Values.probo.openai.apiKey | quote }}
  {{- end }}

  # Optional SAML secrets
  {{- if and .Values.probo.saml.enabled .Values.probo.saml.certificate }}
  saml-certificate: {{ .Values.probo.saml.certificate | quote }}
  {{- end }}
  {{- if and .Values.probo.saml.enabled .Values.probo.saml.privateKey }}
  saml-private-key: {{ .Values.probo.saml.privateKey | quote }}
  {{- end }}

  # Optional Connector secrets
  {{- range .Values.probo.connectors }}
  {{- if eq .name "slack" }}
  {{- if .config.clientId }}
  connector-slack-client-id: {{ .config.clientId | quote }}
  {{- end }}
  {{- if .config.clientSecret }}
  connector-slack-client-secret: {{ .config.clientSecret | quote }}
  {{- end }}
  {{- if .config.signingSecret }}
  connector-slack-signing-secret: {{ .config.signingSecret | quote }}
  {{- end }}
  {{- end }}
  {{- end }}
